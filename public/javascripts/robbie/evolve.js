// Generated by CoffeeScript 1.3.3
var fittest, i, launch_worker, refresh, run_sim, socket, _i;

fittest = (new Simulation).random_dna();

socket = io.connect('http://109.107.37.65');

socket.on('status', function(new_status) {
  return refresh(new_status);
});

socket.on('reset', function() {
  return window.location.reload(true);
});

launch_worker = function() {
  var worker1;
  worker1 = new Worker("/javascripts/robbie/worker.js");
  worker1.postMessage("");
  return worker1.onmessage = function(message) {
    var _ref;
    if (((_ref = message.data) != null ? _ref.dna : void 0) != null) {
      return fittest = message.data.dna;
    } else {
      return console.log(message.data);
    }
  };
};

for (i = _i = 0; _i <= 4; i = ++_i) {
  launch_worker();
}

run_sim = function() {
  var animation_rate, count, s, step;
  s = new Simulation(fittest);
  animation_rate = 100;
  count = 0;
  step = function() {
    s.step();
    s.display_canvas('board');
    count++;
    if (count === 200) {
      s = new Simulation(fittest);
      count = 0;
    }
    return setTimeout(step, animation_rate);
  };
  return step();
};

refresh = function(status) {
  fittest = status.fittest.fitness;
  $('#connected').html(status.connected);
  $('#fittest-dna').html(status.fittest.dna);
  $('#uptime').html("" + ((status.uptime / 1000 / 60).toFixed(2)) + " Minutes");
  return $('#fittest-fitness').html(status.fittest.fitness);
};

$(document).ready(run_sim);
